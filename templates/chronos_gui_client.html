<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Chronos ‚Äì Event Manager v2.2 (Premium)</title>

    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Premium CSS -->
    <link rel="stylesheet" href="/static/css/chronos-premium.css">

    <style>
        .client-container {
            display: grid;
            grid-template-columns: minmax(280px, 20%) 1fr;
            height: 100vh;
            gap: 0;
        }

        /* Responsive sidebar width based on screen size */
        @media (min-width: 1200px) {
            .client-container {
                grid-template-columns: minmax(320px, 18%) 1fr;
            }
        }

        @media (min-width: 1600px) {
            .client-container {
                grid-template-columns: minmax(360px, 15%) 1fr;
            }
        }

        @media (min-width: 2000px) {
            .client-container {
                grid-template-columns: minmax(400px, 12%) 1fr;
            }
        }

        .client-main {
            padding: var(--space-6);
            display: flex;
            flex-direction: column;
            gap: var(--space-6);
            height: 100%;
            overflow: hidden;
            width: 100%;
            max-width: none;
        }
        .events-list-container {
            flex: 1;
            overflow-y: auto;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            grid-auto-rows: min-content;
            gap: var(--space-4);
            width: 100%;
        }

        /* Single column for narrow containers */
        @media (max-width: 900px) {
            .events-list-container {
                grid-template-columns: 1fr;
            }
        }

        /* Multi-column for wide screens */
        @media (min-width: 1400px) {
            .events-list-container {
                grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
                gap: var(--space-5);
            }
        }

        @media (min-width: 1800px) {
            .events-list-container {
                grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
                gap: var(--space-6);
            }
        }
        .template-list-item {
            cursor: pointer;
            padding: var(--space-4);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-subtle);
            background: var(--surface-primary);
            transition: all var(--duration-fast) var(--ease-out);
        }
        .template-list-item:hover {
            background: var(--state-hover);
            border-color: var(--border-base);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }
    </style>
</head>
<body class="chronos-app">
<div class="app-container client-container" id="app">
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2 class="sidebar-title">Kalender-Filter</h2>
        </div>
        <div class="sidebar-content">
            <div class="form-group">
                <label for="range-select" class="form-label">Zeitbereich</label>
                <select id="range-select" class="form-select">
                    <option value="7">7 Tage</option>
                    <option value="14">14 Tage</option>
                    <option value="30">30 Tage</option>
                    <option value="60">60 Tage</option>
                    <option value="360">360 Tage</option>
                    <option value="-1">Alle Events</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Richtung</label>
                <div class="btn-group">
                    <input type="radio" class="btn-check" name="direction" id="dir-past" value="past">
                    <label class="btn btn-secondary" for="dir-past">Vergangenheit</label>
                    <input type="radio" class="btn-check" name="direction" id="dir-future" value="future" checked>
                    <label class="btn btn-secondary" for="dir-future">Zukunft</label>
                    <input type="radio" class="btn-check" name="direction" id="dir-all" value="all">
                    <label class="btn btn-secondary" for="dir-all">Alle</label>
                </div>
            </div>
            <div class="form-group">
                <label for="search-input" class="form-label">Suche</label>
                <input id="search-input" type="text" class="form-input" placeholder="Titel/Beschreibung...">
            </div>
            <div class="form-actions">
                <button id="btn-new" class="btn btn-secondary">Neuer Termin</button>
                <button id="btn-sync" class="btn btn-secondary">Kalender Sync</button>
                <button id="btn-templates" class="btn btn-primary">Vorlage nutzen</button>
            </div>
        </div>
    </aside>

    <main class="client-main">
        <header class="header">
            <div class="header-content">
                <div class="header-title">
                    <h1>Events</h1>
                    <p class="header-subtitle" id="status" role="status" aria-live="polite">Bereit</p>
                </div>
                <div class="header-actions">
                    <div class="metric-card" style="padding: var(--space-3); min-width: auto;">
                        <span class="metric-label">Events:</span>
                        <span class="metric-value" id="kpi-count">‚Äî</span>
                    </div>
                </div>
            </div>
        </header>
        <section id="list" class="events-list-container" aria-busy="false" aria-label="Eventliste">
            <!-- Events werden hier eingef√ºgt -->
        </section>
    </main>
</div>

<dialog id="tplDialog" class="modal" aria-modal="true" aria-labelledby="tplTitle">
    <div class="modal-backdrop"></div>
    <div class="modal-content modal-lg">
        <header class="modal-header">
            <h2 class="modal-title" id="tplTitle">Vorlagen</h2>
            <button id="tplClose" class="btn btn-icon modal-close" aria-label="Schlie√üen">‚úï</button>
        </header>
        <div class="modal-body" style="display: grid; grid-template-columns: 320px 1fr; gap: var(--space-6);">
            <div class="template-sidebar">
                <input id="tplSearch" type="text" class="form-input" placeholder="Vorlagen suchen..." style="margin-bottom: var(--space-4);">
                <div class="templates-list" id="tplList" style="max-height: 60vh; overflow-y: auto;"></div>
            </div>
            <div class="template-details" id="tplDetails">
                <div class="placeholder">
                    <div class="placeholder-icon">üìù</div>
                    <div class="placeholder-title">Vorlage ausw√§hlen</div>
                    <div class="placeholder-text">W√§hle eine Vorlage aus der Liste, um Details anzuzeigen.</div>
                </div>
            </div>
        </div>
    </div>
</dialog>

<dialog id="createEventDialog" class="modal" aria-modal="true" aria-labelledby="createEventTitle">
    <div class="modal-backdrop" data-ref="backdrop"></div>
    <div class="modal-content modal-lg">
        <header class="modal-header">
            <h2 class="modal-title" id="createEventTitle">Neues Event erstellen</h2>
            <button id="createEventClose" class="btn btn-icon modal-close" data-ref="close" aria-label="Schlie√üen">‚úï</button>
        </header>
        <div class="modal-body">
            <form id="createEventForm" data-ref="form" class="create-event-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="eventTitle" class="form-label required">Titel</label>
                        <input id="eventTitle" name="title" type="text" class="form-input" data-ref="title"
                               placeholder="Event-Titel eingeben..." required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="eventCalendar" class="form-label required">Zielkalender</label>
                        <select id="eventCalendar" name="calendar_id" class="form-select" data-ref="calendar" required>
                            <option value="">Kalender ausw√§hlen...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="eventTemplate" class="form-label">Vorlage verwenden</label>
                        <div class="template-selection">
                            <select id="eventTemplate" name="template_id" class="form-select" data-ref="template">
                                <option value="">Keine Vorlage</option>
                            </select>
                            <button type="button" class="btn btn-secondary btn-sm" data-ref="use-template" disabled>
                                Anwenden
                            </button>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" name="all_day" data-ref="all-day" class="form-checkbox">
                            Ganzt√§gig
                        </label>
                    </div>
                </div>

                <div class="form-row time-inputs">
                    <div class="form-group">
                        <label for="eventStartTime" class="form-label">Startzeit</label>
                        <input id="eventStartTime" name="start_time" type="datetime-local" class="form-input" data-ref="start-time">
                    </div>
                    <div class="form-group">
                        <label for="eventEndTime" class="form-label">Endzeit</label>
                        <input id="eventEndTime" name="end_time" type="datetime-local" class="form-input" data-ref="end-time">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="eventDescription" class="form-label">Beschreibung</label>
                        <textarea id="eventDescription" name="description" class="form-textarea" data-ref="description"
                                  rows="3" placeholder="Eventbeschreibung (optional)..."></textarea>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="eventLocation" class="form-label">Ort</label>
                        <input id="eventLocation" name="location" type="text" class="form-input" data-ref="location"
                               placeholder="Veranstaltungsort (optional)...">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="eventPriority" class="form-label">Priorit√§t</label>
                        <select id="eventPriority" name="priority" class="form-select" data-ref="priority">
                            <option value="LOW">Niedrig</option>
                            <option value="MEDIUM" selected>Mittel</option>
                            <option value="HIGH">Hoch</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="eventType" class="form-label">Event-Typ</label>
                        <select id="eventType" name="event_type" class="form-select" data-ref="event-type">
                            <option value="TASK">Aufgabe</option>
                            <option value="MEETING">Meeting</option>
                            <option value="REMINDER">Erinnerung</option>
                            <option value="DEADLINE">Deadline</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="eventTags" class="form-label">Tags</label>
                        <input id="eventTags" name="tags" type="text" class="form-input" data-ref="tags"
                               placeholder="Tag1, Tag2, Tag3...">
                        <small class="form-help">Getrennt durch Kommas</small>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="eventAttendees" class="form-label">Teilnehmer</label>
                        <input id="eventAttendees" name="attendees" type="text" class="form-input" data-ref="attendees"
                               placeholder="email1@example.com, email2@example.com...">
                        <small class="form-help">E-Mail-Adressen getrennt durch Kommas</small>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-ref="cancel">Abbrechen</button>
            <button type="submit" form="createEventForm" class="btn btn-primary" data-ref="save">
                <span class="btn-text">Event erstellen</span>
                <span class="btn-spinner" style="display: none;">‚ü≥</span>
            </button>
        </div>
    </div>
</dialog>

<script>
(function(){
  // CONFIG & HELPERS
  const API_BASE = localStorage.getItem('chronos_api') || 'http://localhost:8081/api/v1';
  const API_KEY  = localStorage.getItem('chronos_api_key') || '';
  const DEFAULT_CAL = localStorage.getItem('chronos_calendar') || 'primary';
  const TZ = 'Europe/Berlin';

  const $ = (sel, root=document) => root.querySelector(sel);
  const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
  const escapeHtml = (s='') => s.replace(/[&<>"]+/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
  const debounce = (fn, ms=300) => {
    let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args), ms); };
  };
  const fmtDateTime = (isoUtc) => {
    if (!isoUtc) return '';
    try{
      return new Date(isoUtc).toLocaleString('de-DE', { timeZone: TZ, year:'numeric', month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit' });
    }catch{ return isoUtc }
  };

  // STATE
  const state = {
    range: '7', direction: 'future', q:'', page:1, pageSize:100,
    events: [], templates: [], selectedTemplate: null
  };

  // API
  async function api(path, {method='GET', params=null, body=null}={}){
    const url = new URL(API_BASE + path, window.location.origin);
    if (params) Object.entries(params).forEach(([k,v])=> (v!==undefined && v!==null && v!=='') && url.searchParams.append(k, v));
    const res = await fetch(url.toString(), {
      method,
      headers: { 'Accept': 'application/json', 'Content-Type': 'application/json', ...(API_KEY ? {'X-API-Key': API_KEY} : {}) },
      body: body ? JSON.stringify(body) : null
    });
    if (!res.ok) { const txt=await res.text().catch(()=>''); throw new Error(`API-Fehler ${res.status}: ${txt}`); }
    return res.json();
  }

  // LOGIC
  async function fetchEvents(){
    $('#list').setAttribute('aria-busy','true');
    $('#status').textContent = 'Lade Events...';
    try{
      const data = await api('/events', { params: {
        calendar: DEFAULT_CAL,
        range: state.range,
        direction: (state.range === '-1') ? 'all' : state.direction,
        q: state.q,
        page: state.page,
        page_size: state.pageSize
      }});
      state.events = data.items || [];
      renderEvents();
      $('#status').textContent = `${state.events.length} Eintr√§ge geladen`;
      $('#kpi-count').textContent = String(state.events.length);
    }catch(err){
      $('#status').textContent = String(err.message||err);
      $('#list').innerHTML = `<div class="placeholder"><div class="placeholder-icon">‚ö†Ô∏è</div><div class="placeholder-title">Fehler beim Laden</div><div class="placeholder-text">${escapeHtml(String(err.message||err))}</div><button id="retry" class="btn btn-secondary">Erneut versuchen</button></div>`;
      $('#retry')?.addEventListener('click', fetchEvents);
    }finally{ $('#list').setAttribute('aria-busy','false'); }
  }

  async function searchTemplates(q){
    const listEl = $('#tplList'); listEl.setAttribute('aria-busy','true');
    try{
      const data = await api('/templates', { params: { q, page:1, page_size:100 } });
      state.templates = data.items || [];
      renderTemplates(q);
    }catch(err){
      listEl.innerHTML = `<div class="placeholder-text">${escapeHtml(String(err.message||err))}</div>`;
    }finally{ listEl.setAttribute('aria-busy','false'); }
  }

  async function useTemplate(id){
    try{
      // Record template usage
      await api(`/templates/${id}/use`, { method:'POST' });

      // Find the template data
      const template = state.templates.find(t => t.id === id);
      if (!template) {
        console.error('Template not found:', id);
        return;
      }

      // Open create event modal with template data pre-filled
      if (!createEventModal) {
        const dialogElement = $('#createEventDialog');
        if (dialogElement) {
          createEventModal = new CreateEventModalComponent(dialogElement, {
            apiEndpoint: API_BASE + '/events',
            calendarsEndpoint: API_BASE + '/caldav/calendars',
            templatesEndpoint: API_BASE + '/templates'
          });

          createEventModal.addEventListener('createEvent:success', (event) => {
            fetchEvents();
          });
        }
      }

      if (createEventModal) {
        // Prepare template data for form
        const formData = {
          title: template.title || '',
          description: template.description || '',
          all_day: Boolean(template.all_day),
          calendar_id: template.calendar_id || DEFAULT_CAL
        };

        // Handle duration for non-all-day events
        if (template.duration_minutes && !template.all_day) {
          const now = new Date();
          let startTime = now;

          // Apply default time if specified
          if (template.default_time) {
            const [hours, minutes] = template.default_time.split(':').map(Number);
            startTime = new Date(now);
            startTime.setHours(hours, minutes, 0, 0);

            // If time is in the past today, schedule for tomorrow
            if (startTime < now) {
              startTime.setDate(startTime.getDate() + 1);
            }
          }

          const endTime = new Date(startTime.getTime() + (template.duration_minutes * 60000));

          formData.start_time = startTime.toISOString().slice(0, 16);
          formData.end_time = endTime.toISOString().slice(0, 16);
        }

        // Handle tags
        if (template.tags && template.tags.length > 0) {
          formData.tags = template.tags;
        }

        // Open modal with pre-filled data
        createEventModal.open({ formData });
      }
    }
    catch(e){
      console.error('useTemplate fehlgeschlagen:', e);
      $('#status').textContent = `Fehler beim Anwenden der Vorlage: ${e.message}`;
    }
  }

  // RENDER
  function renderEvents(){
    const listEl = $('#list');
    listEl.innerHTML = '';
    if (!state.events.length){
      listEl.innerHTML = `<div class="placeholder"><div class="placeholder-icon">üì≠</div><div class="placeholder-title">Keine Eintr√§ge gefunden</div><div class="placeholder-text">√Ñndere die Filter oder erstelle neue Events.</div></div>`;
      return;
    }
    const frag = document.createDocumentFragment();
    for (const ev of state.events){
      const item = document.createElement('div');
      item.className = 'event-card';
      const isAllDay = !!ev.all_day;
      const when = isAllDay ? ev.all_day_date : `${fmtDateTime(ev.start_utc)} - ${fmtDateTime(ev.end_utc)}`;
      item.innerHTML = `
        <div class="event-details">
            <h4 class="event-title">${escapeHtml(ev.title || '(ohne Titel)')}</h4>
            <p class="event-meta">${escapeHtml(ev.description||'')}</p>
            <p class="event-meta" style="color: var(--text-muted);">${when}</p>
        </div>
        <div class="event-actions">
            <span class="priority-label ${isAllDay ? 'high' : 'medium'}">${isAllDay ? 'Ganzt√§gig' : 'Zeitgebunden'}</span>
        </div>
      `;
      frag.appendChild(item);
    }
    listEl.appendChild(frag);
  }

  function renderTemplates(q=''){
    const listEl = $('#tplList'); listEl.innerHTML='';
    if (!state.templates.length){ listEl.innerHTML = `<div class="placeholder-text">Keine Vorlagen gefunden.</div>`; return; }
    const frag = document.createDocumentFragment();
    state.templates.forEach(t => {
      const item = document.createElement('div');
      item.className='template-list-item';
      item.setAttribute('data-id', t.id);
      item.innerHTML = `
        <h4 class="list-item-title">${escapeHtml(t.title)}</h4>
        <p class="list-item-meta muted">${escapeHtml(t.description||'')}</p>
      `;
      item.addEventListener('click', ()=> selectTemplate(t));
      frag.appendChild(item);
    });
    listEl.appendChild(frag);
  }

  function selectTemplate(t){
    state.selectedTemplate = t;
    $('#tplDetails').innerHTML = `
        <h3 class="modal-subtitle">${escapeHtml(t.title)}</h3>
        <p>${escapeHtml(t.description||'')}</p>
        <div class="info-grid">
            <div class="info-item">
                <span class="info-label">Typ</span>
                <span class="info-value">${t.all_day ? 'Ganzt√§gig' : `Default-Zeit: ${escapeHtml(t.default_time||'‚Äî')}`}</span>
            </div>
            <div class="info-item">
                <span class="info-label">Dauer</span>
                <span class="info-value">${t.duration_minutes||'‚Äî'} Minuten</span>
            </div>
            <div class="info-item">
                <span class="info-label">Tags</span>
                <span class="info-value">${(t.tags||[]).map(escapeHtml).join(', ') || '‚Äî'}</span>
            </div>
             <div class="info-item">
                <span class="info-label">Verwendet</span>
                <span class="info-value">${t.usage_count ?? 0} mal</span>
            </div>
        </div>
        <div class="form-actions" style="margin-top: auto;">
            <button id="tplApply" class="btn btn-primary">Vorlage verwenden</button>
        </div>
    `;
    $('#tplApply').addEventListener('click', async ()=>{
      await useTemplate(t.id);
      closeTemplates();
      fetchEvents();
    });
  }

  // MODAL
  const dlg = $('#tplDialog');
  function openTemplates(){
    dlg.showModal();
    searchTemplates('');
    $('#tplSearch').focus();
  }
  function closeTemplates(){
    if (dlg.open) dlg.close();
  }

  // CREATE EVENT FUNCTIONALITY
  let createEventModal = null;

  function createNewEvent(){
    if (!createEventModal) {
      const dialogElement = $('#createEventDialog');
      if (dialogElement) {
        createEventModal = new CreateEventModalComponent(dialogElement, {
          apiEndpoint: API_BASE + '/events',
          calendarsEndpoint: API_BASE + '/caldav/calendars',
          templatesEndpoint: API_BASE + '/templates'
        });

        // Listen for events
        createEventModal.addEventListener('createEvent:success', (event) => {
          fetchEvents(); // Refresh events list
        });
      }
    }

    if (createEventModal) {
      createEventModal.open();
    }
  }

  // SYNC FUNCTIONALITY
  async function syncCalendar(){
    const syncBtn = $('#btn-sync');
    const originalText = syncBtn.textContent;

    try{
      syncBtn.disabled = true;
      syncBtn.textContent = 'Synchronisiere...';
      $('#status').textContent = 'Kalender wird synchronisiert...';

      // Trigger calendar sync
      const syncData = await api('/sync/calendar', {
        method: 'POST',
        body: JSON.stringify({
          days_ahead: parseInt(state.range) || 7,
          force_refresh: true
        })
      });

      if (syncData.success) {
        $('#status').textContent = `Sync erfolgreich: ${syncData.events_processed || 0} Events verarbeitet`;

        // Refresh events after sync
        await fetchEvents();
      } else {
        throw new Error(syncData.error || 'Sync fehlgeschlagen');
      }
    }
    catch(e){
      console.error('Sync error:', e);
      $('#status').textContent = `Sync-Fehler: ${e.message}`;
    }
    finally{
      syncBtn.disabled = false;
      syncBtn.textContent = originalText;
    }
  }

  // INIT
  function init(){
    const debouncedFetch = debounce(fetchEvents, 300);

    $('#range-select').addEventListener('change', (e)=>{ state.range = e.target.value; debouncedFetch(); });
    $$('input[name="direction"]').forEach(r => r.addEventListener('change', (e)=>{ state.direction = e.target.value; debouncedFetch(); }));
    $('#search-input').addEventListener('input', debounce((e)=>{ state.q = e.target.value; fetchEvents(); }, 300));

    $('#btn-new').addEventListener('click', createNewEvent);
    $('#btn-sync').addEventListener('click', syncCalendar);
    $('#btn-templates').addEventListener('click', openTemplates);
    $('#tplClose').addEventListener('click', closeTemplates);
    dlg.querySelector('.modal-backdrop').addEventListener('click', closeTemplates);
    $('#tplSearch').addEventListener('input', debounce((e)=> searchTemplates(e.target.value), 300));

    fetchEvents();
  }

  // Mock event bus for compatibility
  window.ChronosEventBus = {
    events: new Map(),

    on(eventName, handler, context) {
      if (!this.events.has(eventName)) {
        this.events.set(eventName, new Set());
      }

      const boundHandler = context ? handler.bind(context) : handler;
      this.events.get(eventName).add(boundHandler);

      return () => this.off(eventName, boundHandler);
    },

    off(eventName, handler) {
      if (this.events.has(eventName)) {
        this.events.get(eventName).delete(handler);
      }
    },

    emit(eventName, ...args) {
      if (this.events.has(eventName)) {
        for (const handler of this.events.get(eventName)) {
          try {
            handler(...args);
          } catch (error) {
            console.error('Error in event handler:', error);
          }
        }
      }
    }
  };

  // Global API helpers for components
  window.ChronosAPI = {
    getAuthHeaders: () => API_KEY ? { 'X-API-Key': API_KEY } : {}
  };

  window.addEventListener('DOMContentLoaded', init);
})();
</script>

<!-- Load component dependencies -->
<script src="/static/js/core/ComponentBase.js"></script>
<script src="/static/js/components/CreateEventModal.js"></script>

<style>
/* Create Event Modal Styles */
.create-event-form {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-4);
}

.form-row:has(.form-group:only-child) {
    grid-template-columns: 1fr;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
}

.form-label {
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    color: var(--text-secondary);
}

.form-label.required::after {
    content: ' *';
    color: var(--danger-500);
}

.form-input, .form-select, .form-textarea {
    padding: var(--space-3);
    border: 1px solid var(--border-base);
    border-radius: var(--radius-md);
    background: var(--surface-primary);
    color: var(--text-primary);
    font-size: var(--font-size-sm);
    transition: all var(--duration-fast) var(--ease-out);
}

.form-input:focus, .form-select:focus, .form-textarea:focus {
    outline: 2px solid var(--state-focus-ring);
    outline-offset: 2px;
    border-color: var(--border-focus);
}

.form-field-error {
    border-color: var(--danger-400) !important;
    background-color: var(--status-danger-bg);
}

.form-checkbox {
    width: 16px;
    height: 16px;
    margin-right: var(--space-2);
}

.form-help {
    font-size: var(--font-size-xs);
    color: var(--text-muted);
    margin-top: var(--space-1);
}

.template-selection {
    display: flex;
    gap: var(--space-2);
    align-items: end;
}

.template-selection .form-select {
    flex: 1;
}

.time-inputs.hidden {
    display: none;
}

.btn-spinner {
    font-size: var(--font-size-sm);
    animation: spin 1s linear infinite;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* Mobile-first responsive design */
@media (max-width: 768px) {
    .modal-content {
        margin: var(--space-4);
        width: calc(100vw - var(--space-8));
        max-width: none;
        height: calc(100vh - var(--space-8));
        max-height: none;
    }

    .form-row {
        grid-template-columns: 1fr;
        gap: var(--space-3);
    }

    .template-selection {
        flex-direction: column;
        align-items: stretch;
        gap: var(--space-2);
    }

    .modal-body {
        padding: var(--space-4);
        max-height: calc(100vh - 150px);
        overflow-y: auto;
    }

    .form-input, .form-select, .form-textarea {
        font-size: 16px; /* Prevent zoom on iOS */
        padding: var(--space-4);
    }
}

/* Wide screen optimizations */
@media (min-width: 1200px) {
    .modal-content.modal-lg {
        max-width: 800px;
        width: 800px;
    }

    .form-row {
        grid-template-columns: 1fr 1fr;
        gap: var(--space-6);
    }

    .create-event-form {
        gap: var(--space-5);
    }
}

/* Ultra-wide screen improvements */
@media (min-width: 1600px) {
    .modal-content.modal-lg {
        max-width: 900px;
        width: 900px;
    }

    .form-row:has(.form-group:only-child) {
        grid-template-columns: 1fr 1fr;
    }

    .form-row:has(.form-group:only-child) .form-group {
        grid-column: 1 / 2;
    }
}
</style>

</body>
</html>