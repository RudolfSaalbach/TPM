<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Chronos Engine{% endblock %}</title>

    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Premium CSS -->
    <link rel="stylesheet" href="{{ url_for('static', path='css/chronos-premium.css') }}">

    <link rel="icon" type="image/x-icon" href="{{ url_for('static', path='favicon.ico') }}">

    {% block extra_head %}{% endblock %}
</head>
<body>
    <!-- Skip Link f√ºr Barrierefreiheit -->
    <a href="#main-content" class="skip-link">Zum Hauptinhalt springen</a>

    <div class="app-container">
        <!-- Sidebar Overlay f√ºr Mobile -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

        <!-- Sidebar Navigation -->
        <nav class="sidebar" id="sidebar" role="navigation" aria-label="Hauptnavigation">
            <div class="sidebar-header">
                <a href="/" class="logo">
                    <div class="logo-icon" aria-hidden="true">‚è∞</div>
                    <span class="logo-text">Chronos</span>
                </a>
            </div>

            <div class="sidebar-nav">
                <a href="/dashboard" class="nav-item {% if request.url.path == '/dashboard' or request.url.path == '/' %}active{% endif %}" {% if request.url.path == '/dashboard' or request.url.path == '/' %}aria-current="page"{% endif %}>
                    <div class="nav-item-indicator"></div>
                    <span class="nav-icon" role="img" aria-label="Dashboard">üìä</span>
                    <span>Dashboard</span>
                </a>
                <a href="/calendar" class="nav-item {% if request.url.path == '/calendar' %}active{% endif %}" {% if request.url.path == '/calendar' %}aria-current="page"{% endif %}>
                    <div class="nav-item-indicator"></div>
                    <span class="nav-icon" role="img" aria-label="Kalender">üìÖ</span>
                    <span>Kalender</span>
                </a>
                <a href="/events" class="nav-item {% if request.url.path == '/events' %}active{% endif %}" {% if request.url.path == '/events' %}aria-current="page"{% endif %}>
                    <div class="nav-item-indicator"></div>
                    <span class="nav-icon" role="img" aria-label="Events">üìã</span>
                    <span>Events</span>
                </a>
                <a href="/analytics" class="nav-item {% if request.url.path == '/analytics' %}active{% endif %}" {% if request.url.path == '/analytics' %}aria-current="page"{% endif %}>
                    <div class="nav-item-indicator"></div>
                    <span class="nav-icon" role="img" aria-label="Analytics">üìà</span>
                    <span>Analytics</span>
                </a>
                <a href="/sync" class="nav-item {% if request.url.path == '/sync' %}active{% endif %}" {% if request.url.path == '/sync' %}aria-current="page"{% endif %}>
                    <div class="nav-item-indicator"></div>
                    <span class="nav-icon" role="img" aria-label="Sync">üîÑ</span>
                    <span>Sync</span>
                </a>
                <a href="/settings" class="nav-item {% if request.url.path == '/settings' %}active{% endif %}" {% if request.url.path == '/settings' %}aria-current="page"{% endif %}>
                    <div class="nav-item-indicator"></div>
                    <span class="nav-icon" role="img" aria-label="Einstellungen">‚öôÔ∏è</span>
                    <span>Einstellungen</span>
                </a>
                <a href="/admin" class="nav-item {% if request.url.path.startswith('/admin') %}active{% endif %}" {% if request.url.path.startswith('/admin') %}aria-current="page"{% endif %}>
                    <div class="nav-item-indicator"></div>
                    <span class="nav-icon" role="img" aria-label="Admin">üîß</span>
                    <span>Admin</span>
                </a>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content" id="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-content">
                    <div class="header-title">
                        <h1>{% block page_title %}{% endblock %}</h1>
                        <p class="header-subtitle">{% block page_subtitle %}{% endblock %}</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="toggleSidebar()" aria-label="Seitenleiste umschalten">
                            <span aria-hidden="true">‚ò∞</span>
                        </button>
                        {% block header_actions %}{% endblock %}
                    </div>
                </div>
            </header>

            <!-- Page Content -->
            <div class="dashboard-content">
                {% block content %}{% endblock %}
            </div>
        </main>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer" role="region" aria-live="polite" aria-label="Benachrichtigungen"></div>

    <!-- Loading Overlay -->
    <div class="modal-overlay" id="loadingOverlay" style="display: none;" aria-hidden="true">
        <div class="spinner"></div>
    </div>

    <!-- JavaScript -->
    <script>
        // Globale Variablen
        let sidebarOpen = false;

        // DOM Content Loaded
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
        });

        // App Initialization
        function initializeApp() {
            loadSidebarState();

            // ARIA-Unterst√ºtzung f√ºr Toast-Container
            const toastContainer = document.getElementById('toastContainer');
            if (toastContainer) {
                toastContainer.setAttribute('aria-live', 'polite');
                toastContainer.setAttribute('aria-atomic', 'true');
            }
        }

        // Event Listeners Setup
        function setupEventListeners() {
            // Keyboard Navigation
            document.addEventListener('keydown', handleKeyboardNavigation);

            // Escape key f√ºr Modals
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeSidebar();
                }
            });

            // Responsive Sidebar
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768 && sidebarOpen) {
                    closeSidebar();
                }
            });
        }

        // Keyboard Navigation
        function handleKeyboardNavigation(e) {
            // Alt + M: Toggle Sidebar
            if (e.altKey && e.key === 'm') {
                e.preventDefault();
                toggleSidebar();
            }
        }

        // Sidebar Functions
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');

            if (window.innerWidth <= 768) {
                sidebarOpen = !sidebarOpen;
                sidebar.classList.toggle('open', sidebarOpen);
                overlay.classList.toggle('open', sidebarOpen);

                // ARIA
                sidebar.setAttribute('aria-hidden', !sidebarOpen);

                // Focus Management
                if (sidebarOpen) {
                    sidebar.querySelector('.nav-item').focus();
                }
            }
        }

        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');

            sidebarOpen = false;
            sidebar.classList.remove('open');
            overlay.classList.remove('open');
            sidebar.setAttribute('aria-hidden', 'true');
        }

        function loadSidebarState() {
            // Load nur f√ºr Desktop relevant
            if (window.innerWidth > 768) {
                const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
                if (isCollapsed) {
                    document.querySelector('.app-container').classList.add('sidebar-collapsed');
                }
            }
        }

        // Utility Functions
        function showLoading() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.style.display = 'flex';
                overlay.setAttribute('aria-hidden', 'false');
            }
        }

        function hideLoading() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.style.display = 'none';
                overlay.setAttribute('aria-hidden', 'true');
            }
        }

        // Toast System
        function showToast(title, message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer') || createToastContainer();
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.setAttribute('role', 'alert');

            toast.innerHTML = `
                <div class="toast-header">
                    <h4 class="toast-title">${title}</h4>
                    <button class="toast-close" onclick="removeToast(this.parentElement.parentElement)" aria-label="Benachrichtigung schlie√üen">
                        <span aria-hidden="true">√ó</span>
                    </button>
                </div>
                <div class="toast-body">${message}</div>
            `;

            toastContainer.appendChild(toast);

            // Animate in
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);

            // Auto-remove nach 8 Sekunden
            setTimeout(() => {
                removeToast(toast);
            }, 8000);
        }

        function createToastContainer() {
            const container = document.createElement('div');
            container.id = 'toastContainer';
            container.className = 'toast-container';
            container.setAttribute('role', 'region');
            container.setAttribute('aria-live', 'polite');
            container.setAttribute('aria-label', 'Benachrichtigungen');
            document.body.appendChild(container);
            return container;
        }

        function removeToast(toast) {
            if (toast && toast.parentElement) {
                toast.classList.add('fade-out');
                setTimeout(() => {
                    if (toast.parentElement) {
                        toast.remove();
                    }
                }, 400);
            }
        }
    </script>

    {% block extra_scripts %}{% endblock %}
</body>
</html>