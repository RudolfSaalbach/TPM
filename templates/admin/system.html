{% extends "admin/base.html" %}

{% block title %}System - Chronos Admin{% endblock %}
{% block header_title %}Systeminformationen{% endblock %}
{% block header_subtitle %}Datenbankgesundheit, Tabellenstatistiken und Systemmetriken{% endblock %}

{% block content %}
<div class="system-overview animate-fade-in">
    <div class="system-header">
        <h2>System√ºbersicht</h2>
        <p>Aktuelle Systemmetriken und Datenbankstatistiken</p>
    </div>

    <div class="system-grid animate-stagger">
        <div class="card system-card">
            <div class="card-header">
                <h3 class="card-title">
                    <span class="card-icon">üíæ</span>
                    Datenbankstatistiken
                </h3>
            </div>
            <div class="system-stats">
                <div class="stat-item">
                    <span class="stat-label">Datenbankgr√∂√üe:</span>
                    <span class="stat-value">{{ db_stats.size | default('‚Äî') }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Anzahl Tabellen:</span>
                    <span class="stat-value">{{ db_stats.table_count | default('‚Äî') }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Gesamte Eintr√§ge:</span>
                    <span class="stat-value">{{ db_stats.total_rows | default('‚Äî') }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Letzte Optimierung:</span>
                    <span class="stat-value">{{ db_stats.last_optimization | default('‚Äî') }}</span>
                </div>
            </div>
        </div>

        <div class="card system-card">
            <div class="card-header">
                <h3 class="card-title">
                    <span class="card-icon">‚ö°</span>
                    Performance-Metriken
                </h3>
            </div>
            <div class="system-stats">
                <div class="stat-item">
                    <span class="stat-label">Durchschnittliche Antwortzeit:</span>
                    <span class="stat-value">{{ performance.avg_response_time | default('‚Äî') }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Requests pro Minute:</span>
                    <span class="stat-value">{{ performance.requests_per_minute | default('‚Äî') }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Fehlerrate:</span>
                    <span class="stat-value">{{ performance.error_rate | default('‚Äî') }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Uptime:</span>
                    <span class="stat-value">{{ performance.uptime | default('‚Äî') }}</span>
                </div>
            </div>
        </div>

        <div class="card system-card">
            <div class="card-header">
                <h3 class="card-title">
                    <span class="card-icon">üîÑ</span>
                    Synchronisation
                </h3>
            </div>
            <div class="system-stats">
                <div class="stat-item">
                    <span class="stat-label">Letzte Synchronisation:</span>
                    <span class="stat-value">{{ sync_stats.last_sync | default('‚Äî') }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Erfolgreiche Syncs:</span>
                    <span class="stat-value">{{ sync_stats.successful_syncs | default('‚Äî') }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Fehlgeschlagene Syncs:</span>
                    <span class="stat-value">{{ sync_stats.failed_syncs | default('‚Äî') }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">API Quota:</span>
                    <span class="stat-value">{{ sync_stats.api_quota | default('‚Äî') }}</span>
                </div>
            </div>
        </div>

        <div class="card system-card">
            <div class="card-header">
                <h3 class="card-title">
                    <span class="card-icon">üìä</span>
                    Event-Statistiken
                </h3>
            </div>
            <div class="system-stats">
                <div class="stat-item">
                    <span class="stat-label">Gesamte Events:</span>
                    <span class="stat-value">{{ event_stats.total_events | default('‚Äî') }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Events heute:</span>
                    <span class="stat-value">{{ event_stats.events_today | default('‚Äî') }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Events diese Woche:</span>
                    <span class="stat-value">{{ event_stats.events_this_week | default('‚Äî') }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Durchschnitt pro Tag:</span>
                    <span class="stat-value">{{ event_stats.avg_per_day | default('‚Äî') }}</span>
                </div>
            </div>
        </div>
    </div>

    <div class="system-actions">
        <h3>System-Aktionen</h3>
        <div class="action-grid">
            <button class="btn btn-secondary action-button" onclick="refreshStats()">
                <span class="btn-icon">üîÑ</span>
                Statistiken aktualisieren
            </button>
            <button class="btn btn-secondary action-button" onclick="optimizeDatabase()">
                <span class="btn-icon">üõ†Ô∏è</span>
                Datenbank optimieren
            </button>
            <button class="btn btn-secondary action-button" onclick="clearCache()">
                <span class="btn-icon">üóëÔ∏è</span>
                Cache leeren
            </button>
            <button class="btn btn-primary action-button" onclick="exportLogs()">
                <span class="btn-icon">üì•</span>
                Logs exportieren
            </button>
        </div>
    </div>
</div>

<style>
.system-overview {
    display: flex;
    flex-direction: column;
    gap: var(--space-8);
}

.system-header h2 {
    margin: 0 0 var(--space-2) 0;
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-bold);
    color: var(--text-primary);
}

.system-header p {
    color: var(--text-secondary);
    margin: 0;
}

.system-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: var(--space-6);
}

.system-card .card-header {
    border-bottom: 1px solid var(--border-subtle);
    padding-bottom: var(--space-4);
    margin-bottom: var(--space-5);
}

.card-title {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    margin: 0;
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    color: var(--text-primary);
}

.card-icon {
    font-size: var(--font-size-xl);
}

.system-stats {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
}

.stat-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-3) 0;
    border-bottom: 1px solid var(--border-subtle);
}

.stat-item:last-child {
    border-bottom: none;
}

.stat-label {
    color: var(--text-secondary);
    font-weight: var(--font-weight-medium);
}

.stat-value {
    color: var(--text-primary);
    font-weight: var(--font-weight-semibold);
    font-variant-numeric: tabular-nums;
}

.system-actions h3 {
    margin: 0 0 var(--space-6) 0;
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    color: var(--text-primary);
}

.action-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--space-4);
}

.action-button {
    justify-content: flex-start;
    padding: var(--space-4);
    height: auto;
}
</style>

<script>
function refreshStats() {
    showToast('Statistiken', 'Aktualisierung gestartet...', 'info');
    // Hier w√ºrde die tats√§chliche Aktualisierung stattfinden
    setTimeout(() => {
        showToast('Statistiken', 'Erfolgreich aktualisiert', 'success');
        location.reload();
    }, 2000);
}

function optimizeDatabase() {
    if (confirm('M√∂chten Sie die Datenbank-Optimierung starten? Dies kann einige Minuten dauern.')) {
        showToast('Datenbank', 'Optimierung gestartet...', 'info');
        // Hier w√ºrde die tats√§chliche Optimierung stattfinden
    }
}

function clearCache() {
    if (confirm('M√∂chten Sie den gesamten Cache leeren?')) {
        showToast('Cache', 'Cache wird geleert...', 'info');
        // Hier w√ºrde das Cache-Clearing stattfinden
    }
}

function exportLogs() {
    showToast('Export', 'Logs werden vorbereitet...', 'info');
    // Hier w√ºrde der Log-Export stattfinden
}

function showToast(title, message, type) {
    // Toast-Funktionalit√§t wie in base.html
    console.log(`${type.toUpperCase()}: ${title} - ${message}`);
}
</script>
{% endblock %}