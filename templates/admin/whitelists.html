{% extends "admin/base.html" %}

{% block title %}System Whitelists - Chronos Admin{% endblock %}
{% block header_title %}System Whitelists{% endblock %}
{% block header_subtitle %}Zugriffskontrolle f&uuml;r externe Systeme und Aktionen{% endblock %}

{% block content %}
<nav class="breadcrumb">
    <a href="/admin">Admin</a>
    <span>/</span>
    <span>Whitelists</span>
</nav>

<div class="page-header">
    <div>
        <h1>Whitelist-Verwaltung</h1>
        <p>Definiere, welche Aktionen externe Systeme mit welchen Parametern ausf&uuml;hren d&uuml;rfen.</p>
    </div>
    <div class="header-actions">
        <a class="btn btn-primary" href="/admin/whitelists/new">+ Neuer Eintrag</a>
    </div>
</div>

<div class="table-card">
    {% if whitelists %}
    <table>
        <thead>
            <tr>
                <th>System</th>
                <th>Aktion</th>
                <th>Erlaubte Parameter</th>
                <th>Status</th>
                <th>Erstellt</th>
                <th>Aktionen</th>
            </tr>
        </thead>
        <tbody>
            {% for whitelist in whitelists %}
            <tr>
                <td><strong>{{ whitelist.system_name }}</strong></td>
                <td><code>{{ whitelist.action_name }}</code></td>
                <td>
                    {% if whitelist.allowed_params %}
                    <div class="params-preview" title="{{ whitelist.allowed_params | tojson }}">
                        {{ whitelist.allowed_params | tojson | truncate(64) }}
                    </div>
                    {% else %}
                    <em>Keine Einschr&auml;nkungen</em>
                    {% endif %}
                </td>
                <td>
                    {% if whitelist.enabled %}
                    <span class="status-pill success">Aktiv</span>
                    {% else %}
                    <span class="status-pill danger">Deaktiviert</span>
                    {% endif %}
                </td>
                <td>{{ whitelist.created_at.strftime('%Y-%m-%d %H:%M') if whitelist.created_at else '-' }}</td>
                <td>
                    <div class="action-group">
                        <a class="btn btn-secondary btn-sm" href="/admin/whitelists/{{ whitelist.id }}/edit">Bearbeiten</a>
                        <form method="post" action="/admin/whitelists/{{ whitelist.id }}/delete" onsubmit="return confirm('Whitelist-Eintrag wirklich l&ouml;schen?')">
                            <button type="submit" class="btn btn-danger btn-sm">l&ouml;schen</button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <h3>Keine Whitelist-Eintr&auml;ge vorhanden</h3>
        <p>Lege deinen ersten Eintrag an, um externe Systeme gezielt freizuschalten.</p>
        <a class="btn btn-primary" href="/admin/whitelists/new">+ Whitelist erstellen</a>
    </div>
    {% endif %}
</div>

<div class="info-panel">
    <h4>Hinweis</h4>
    <ul>
        <li><strong>System:</strong> Zielsystem (z.&nbsp;B. TELEGRAM, N8N, SMTP).</li>
        <li><strong>Aktion:</strong> Erlaubter Befehlsname.</li>
        <li><strong>Parameter:</strong> JSON-Schema der erlaubten Parameter (z.&nbsp;B. {"message": "string", "priority": "int"}).</li>
    </ul>
</div>
{% endblock %}


